global:
  source_service:
    namespace: prod
    name: source-svc
  probe_interval: 30s
  expected_codes: [200]
  telegram:
    bot_token: "YOUR_BOT_TOKEN"
    chat_id: 123456789
  mongodb:
    uri: "mongodb://user:pass@host:27017"
    database: traffic_switcher
    retention_days: 30

rules:
  - domain: "https://api.example.com/health"
    expected_codes: [200]
    force_switch: false
    target_services:
      - namespace: prod
        name: api-svc
      - namespace: prod
        name: web-svc
    notification_message: "API å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œå»ºè®®åˆ‡æ¢æµé‡"
  - domain: "https://another.example.com/check"
    force_switch: false
    target_services:
      - namespace: prod
        name: backend-svc
    notification_message: "åç«¯æœåŠ¡å¼‚å¸¸"

### v2
global:
  source_service:
    namespace: "production"      # æº Serviceï¼ˆé€šå¸¸æ˜¯ä¸»ç«™ Pod çš„ Serviceï¼‰
    name: "main-service"         # æº Service åç§°
  probe_interval: "30s"          # å…¨å±€é»˜è®¤æ¢æµ‹é—´éš”ï¼ˆå¯è¢« rule è¦†ç›–ï¼‰
  expected_codes:                # å…¨å±€é»˜è®¤æœŸæœ› HTTP çŠ¶æ€ç ï¼ˆå¯è¢« endpoint è¦†ç›–ï¼‰
    - 200
    - 301
    - 302
  telegram:
    bot_token: "1234567890:AAF..."  # Telegram Bot Token
    chat_id: "-1001234567890"       # Telegram ç¾¤ç»„/é¢‘é“ IDï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼‰
  mongodb:
    uri: "mongodb://username:password@host:27017"  # MongoDB è¿æ¥ URI
    database: "traffic_switcher"                   # æ•°æ®åº“åç§°
    retention_days: 30                             # äº‹ä»¶æ—¥å¿—å’Œå¤‡ä»½ä¿ç•™å¤©æ•°

rules:
  - base_domain: "https://example.com"   # ä¸»åŸŸåï¼ˆå¿…é¡»åŒ…å« https:// æˆ– http://ï¼‰
    endpoints:                           # å¤šä¸ªæ¢æµ‹ç«¯ç‚¹ï¼ˆæ‰€æœ‰ç«¯ç‚¹éƒ½æˆåŠŸæ‰ç®—å¥åº·ï¼‰
      - path: "/"                        # è·¯å¾„
        method: "GET"                    # GET æˆ– POSTï¼Œé»˜è®¤ GET
        params: {}                       # å¯é€‰ï¼šGET query æˆ– POST JSON å‚æ•°
        expected_codes: []               # å¯é€‰ï¼šè¦†ç›–æœŸæœ›çŠ¶æ€ç ï¼ˆä¸ºç©ºåˆ™ç»§æ‰¿ rule/globalï¼‰
        expected_body_contains: "OK"     # å¯é€‰ï¼šå“åº” body å¿…é¡»åŒ…å«æ­¤å­—ç¬¦ä¸²
      - path: "/health"
        method: "GET"
        expected_body_contains: "healthy"
      - path: "/api/status"
        method: "POST"
        params:
          token: "abc123"
        expected_codes:
          - 200
    probe_interval: "20s"                # æœ¬ rule æ¢æµ‹é—´éš”ï¼ˆè¦†ç›–å…¨å±€ï¼‰
    confirm_count: 2                     # è¿ç»­æ¢æµ‹å¤šå°‘æ¬¡æ‰ç¡®è®¤çŠ¶æ€å˜æ›´ï¼ˆé»˜è®¤ 1ï¼‰
    force_switch: false                  # å¼ºåˆ¶åˆ‡æ¢å¼€å…³ï¼ˆå¼€å¯åç«‹å³è§¦å‘åˆ‡æ¢ï¼Œä»éœ€äººå·¥ç¡®è®¤ï¼‰
    target_services:                     # éœ€è¦åˆ‡æ¢çš„ç›®æ ‡ Serviceï¼ˆé€šå¸¸æ˜¯å¤‡ç”¨ç«™å…¥å£ï¼‰
      - namespace: "production"
        name: "backup-service-1"
      - namespace: "production"
        name: "backup-service-2"
    display_domains:                     # ç”¨äºé€šçŸ¥æ¨¡æ¿ä¸­ {{display_domains}} å ä½ç¬¦å±•ç¤ºçš„åŸŸååˆ—è¡¨
      - "https://main.example.com"
      - "https://www.example.com"
      - "example.com"
    authorized_user_ids:                 # å¯é€‰ï¼šä»…å…è®¸è¿™äº› Telegram UserID æ“ä½œæŒ‰é’®ï¼ˆä¸ºç©ºåˆ™æ— é™åˆ¶ï¼‰
      - 123456789
      - 987654321
    # ä»¥ä¸‹ä¸ºå„ç§é€šçŸ¥æ¨¡æ¿ï¼ˆæ”¯æŒ {{display_domains}} å ä½ç¬¦ï¼‰
    failover_message_template: |         # æ•…éšœåˆ‡æ¢ç¡®è®¤é€šçŸ¥æ¨¡æ¿ï¼ˆä¼˜å…ˆï¼‰
      ğŸš¨ æ•…éšœæ£€æµ‹åˆ°å¼‚å¸¸ï¼Œå‡†å¤‡åˆ‡æ¢æµé‡ ğŸš¨
      
      å½±å“åŸŸåï¼š
      {{display_domains}}
      
      åŸå› ï¼šå¥åº·æ£€æŸ¥è¿ç»­å¤±è´¥
    recovery_message_template: |         # æ¢å¤ç¡®è®¤é€šçŸ¥æ¨¡æ¿
      âœ… æ¢æµ‹æ¢å¤æ­£å¸¸ï¼Œå‡†å¤‡æ¢å¤åŸæµé‡ âœ…
      
      å½±å“åŸŸåï¼š
      {{display_domains}}
    success_failover_message_template: "âœ… å·²æ‰§è¡Œæµé‡æ•…éšœåˆ‡æ¢\nå½±å“åŸŸåï¼š{{display_domains}}"
    success_recovery_message_template: "âœ… å·²æ‰§è¡Œæµé‡æ¢å¤\nå½±å“åŸŸåï¼š{{display_domains}}"

  # æ›´å¤š rule å¯ç»§ç»­æ·»åŠ ...
  # - base_domain: "https://another-site.com"
  #   ...

# å…¼å®¹æ—§ç‰ˆé…ç½®ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚æœåªæä¾› domain è€Œæ—  endpointsï¼Œä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå•ä¸ªé»˜è®¤ endpoint
# - domain: "https://old.example.com/health"


### v3
global:
  source_service:
    namespace: "production"      # æº Serviceï¼ˆé€šå¸¸æ˜¯ä¸»ç«™ Pod çš„ Serviceï¼‰
    name: "main-service"         # æº Service åç§°
  probe_interval: "30s"          # å…¨å±€é»˜è®¤æ¢æµ‹é—´éš”ï¼ˆå¯è¢« rule è¦†ç›–ï¼‰
  expected_codes:                # å…¨å±€é»˜è®¤æœŸæœ› HTTP çŠ¶æ€ç ï¼ˆå¯è¢« endpoint è¦†ç›–ï¼‰
    - 200
    - 301
    - 302
  telegram:
    bot_token: "1234567890:AAF..."  # Telegram Bot Tokenï¼ˆè¯·æ›¿æ¢ä¸ºçœŸå®å€¼ï¼‰
    chat_id: "-1001234567890"       # Telegram ç¾¤ç»„/é¢‘é“ IDï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼‰
  mongodb:
    uri: "mongodb://username:password@host:27017"  # MongoDB è¿æ¥ URI
    database: "traffic_switcher"                   # æ•°æ®åº“åç§°
    retention_days: 30                             # äº‹ä»¶æ—¥å¿—å’Œå¤‡ä»½ä¿ç•™å¤©æ•°

rules:
  - base_domain: "https://hkv2.vpbet.com"   # ä¸»åŸŸåï¼ˆå¿…é¡»åŒ…å«åè®® https:// æˆ– http://ï¼‰
    endpoints:                           # å¤šä¸ªæ¢æµ‹ç«¯ç‚¹ï¼ˆæ‰€æœ‰ç«¯ç‚¹æˆåŠŸæ‰ç®—æ•´ä½“å¥åº·ï¼‰
      - path: "/"                        # ä¸»é¡µ
        method: "GET"
        expected_body_contains: ""       # å¯é€‰ï¼šbody åŒ…å«æ£€æŸ¥ï¼ˆä¸ºç©ºåˆ™ä¸æ£€æŸ¥ï¼‰
      - path: "/health"                  # å¥åº·æ£€æŸ¥è·¯å¾„ç¤ºä¾‹
        method: "GET"
        expected_body_contains: "healthy"
      - path: "/api/status"              # API ç¤ºä¾‹
        method: "POST"
        params:
          token: "your_token"
        expected_codes:
          - 200
    probe_interval: "20s"                # æœ¬ rule æ¢æµ‹é—´éš”ï¼ˆå¯é€‰ï¼Œè¦†ç›–å…¨å±€ï¼‰
    confirm_count: 3                     # è¿ç»­æ¢æµ‹å¤šå°‘æ¬¡æ‰ç¡®è®¤çŠ¶æ€å˜æ›´ï¼ˆæ¨è 2~3ï¼Œé¿å…è¯¯åˆ¤ï¼‰
    force_switch: false                  # å¼ºåˆ¶åˆ‡æ¢å¼€å…³ï¼ˆæ‰‹åŠ¨å¼€å¯åç«‹å³è§¦å‘ï¼Œä»éœ€äººå·¥ç¡®è®¤ï¼‰
    target_services:                     # éœ€è¦åˆ‡æ¢çš„ç›®æ ‡ Serviceï¼ˆå¤‡ç”¨ç«™å…¥å£ï¼‰
      - namespace: "global"
        name: "gaming-websitev2-service"
      - namespace: "production"
        name: "backup-service-2"
    display_domains:                     # ç”¨äº {{display_domains}} å ä½ç¬¦çš„åŸŸååˆ—è¡¨ï¼ˆçº¯åŸŸåï¼Œç¨‹åºä¼šè‡ªåŠ¨æ ¼å¼åŒ–ï¼‰
      - "hkv2.vpbet.com"
      - "www.vpbet.com"
      - "vpbet.com"
    authorized_user_ids:                 # å¯é€‰ï¼šä»…å…è®¸è¿™äº› Telegram UserID æ“ä½œï¼ˆä¸ºç©ºåˆ™æ‰€æœ‰äººå¯æ“ä½œï¼‰
      - 123456789   # ç¤ºä¾‹ UserID
      - 987654321

    # ==================== æœ€æ–°æ¨èé€šçŸ¥æ¨¡æ¿ï¼ˆå·²é€‚é…æœ€æ–°ä»£ç çš„æ¢æµ‹ç»†èŠ‚è¿½åŠ ï¼‰ ====================
    # ä»£ç ä¼šåœ¨æ‰€æœ‰ç¡®è®¤é€šçŸ¥æœ«å°¾å¼ºåˆ¶è¿½åŠ â€œæ¢æµ‹ç»†èŠ‚â€ï¼ˆåŒ…å«æ¯ä¸ª endpoint çš„å®Œæ•´ URLã€æ–¹æ³•ã€æˆåŠŸ/å¤±è´¥ã€çŠ¶æ€ç ã€body æ£€æŸ¥ã€é”™è¯¯ä¿¡æ¯ç­‰ï¼‰
    # å› æ­¤æ¨¡æ¿ä¸­æ— éœ€é‡å¤å†™ç»†èŠ‚éƒ¨åˆ†ï¼Œä¿æŒç®€æ´å³å¯

    failover_message_template: |         # æ•…éšœåˆ‡æ¢ç¡®è®¤é€šçŸ¥ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
      ğŸš¨ã€æ•…éšœå‘Šè­¦ã€‘æ£€æµ‹åˆ°æœåŠ¡å¼‚å¸¸ï¼Œå‡†å¤‡æ‰§è¡Œæµé‡åˆ‡æ¢ğŸš¨
      
      å½±å“åŸŸåï¼š
      {{display_domains}}
      
      è§¦å‘åŸå› ï¼šè¿ç»­ {{confirm_count}} æ¬¡å¥åº·æ£€æŸ¥å¤±è´¥
      
      è¯·ä»”ç»†æŸ¥çœ‹ä¸‹æ–¹â€œæ•…éšœæ¢æµ‹ç»†èŠ‚â€åå†³å®šæ˜¯å¦ç¡®è®¤åˆ‡æ¢ã€‚
      ï¼ˆè‹¥ä¸ºè¯¯æŠ¥æˆ–ä¸´æ—¶æ³¢åŠ¨ï¼Œå¯ç›´æ¥æ‹’ç»ï¼‰

    recovery_message_template: |         # æ¢å¤ç¡®è®¤é€šçŸ¥ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
      âœ…ã€æ¢å¤å‘Šè­¦ã€‘æœåŠ¡æ¢æµ‹å·²è¿ç»­æ­£å¸¸ï¼Œå‡†å¤‡æ‰§è¡Œæµé‡æ¢å¤âœ…
      
      å½±å“åŸŸåï¼š
      {{display_domains}}
      
      è§¦å‘åŸå› ï¼šè¿ç»­ {{confirm_count}} æ¬¡å¥åº·æ£€æŸ¥æˆåŠŸ
      
      è¯·æŸ¥çœ‹ä¸‹æ–¹â€œæ¢å¤æ¢æµ‹ç»†èŠ‚â€ç¡®è®¤æœåŠ¡ç¡®å®ç¨³å®šåï¼Œå†ç¡®è®¤æ¢å¤ã€‚

    success_failover_message_template: | # åˆ‡æ¢æˆåŠŸåé€šçŸ¥
      âœ…ã€åˆ‡æ¢æˆåŠŸã€‘å·²æ‰§è¡Œæµé‡æ•…éšœåˆ‡æ¢
      
      å½±å“åŸŸåï¼š
      {{display_domains}}
      
      æµé‡å·²åˆ‡è‡³å¤‡ç”¨ç«™ï¼Œè¯·åç»­éªŒè¯ä¸šåŠ¡å¯ç”¨æ€§ã€‚

    success_recovery_message_template: |  # æ¢å¤æˆåŠŸåé€šçŸ¥
      âœ…ã€æ¢å¤æˆåŠŸã€‘å·²æ‰§è¡ŒåŸæµé‡æ¢å¤
      
      å½±å“åŸŸåï¼š
      {{display_domains}}
      
      æµé‡å·²åˆ‡å›ä¸»ç«™ï¼Œè¯·éªŒè¯ä¸šåŠ¡æ­£å¸¸ã€‚

  # å¯ç»§ç»­æ·»åŠ æ›´å¤š rule...